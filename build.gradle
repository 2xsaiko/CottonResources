buildscript {
	repositories {
		mavenCentral()
		jcenter()
		maven {
			name = 'Fabric'
			url = 'http://maven.modmuss50.me/'
		}
		maven {
			url "https://plugins.gradle.org/m2/"
		}
	}
	dependencies {
		classpath "net.fabricmc:fabric-loom:0.1.0-SNAPSHOT"
	}
}

apply plugin: net.fabricmc.loom.LoomGradlePlugin
apply plugin: 'maven-publish'

sourceCompatibility = 1.8
targetCompatibility = 1.8

archivesBaseName = "cotton-resources"
group = "io.github.cottonmc"
version = "0.0.1+18w50a"

repositories {
	mavenLocal()
	maven {
		//jankson
		url "http://repo.elytradev.com/"
	}
}

dependencies {
	minecraft "com.mojang:minecraft:18w50a"
	mappings "net.fabricmc:yarn:18w50a.71"
	modCompile "net.fabricmc:fabric-loader:0.3.0.75"
	modCompile "net.fabricmc:fabric:0.1.2.64"

	//the main cotton api.
	modCompile "io.github.cottonmc:cotton:0.0.2+18w50a"
	
	//Neither of these are used at the moment
	//implementation "blue.endless:jankson:1.0.0-7"
	//modCompile "io.github.prospector.silk:SilkAPI:1.0.0-25"
	
	implementation "com.google.code.findbugs:jsr305:3.0.2"
}

publishing {
	publications {
		maven(MavenPublication) {
			from components.java
		
			artifactId = "cotton-resources"
			
			pom.withXml {
				def pomFile = asNode()
				def depsNode = pomFile.get("dependencies");
				pomFile.remove(depsNode);
				
				def newDeps = pomFile.appendNode("dependencies");
				configurations.modCompile.getResolvedConfiguration().getFirstLevelModuleDependencies().each {
					def artifactNode = newDeps.appendNode("dependency")
					artifactNode.appendNode('groupId', it.moduleGroup)
					artifactNode.appendNode('artifactId', it.moduleName)
					artifactNode.appendNode('version', it.moduleVersion)
				}
			}
			artifacts = [
				artifact ("${project.buildDir.absolutePath}/libs/${archivesBaseName}-${version}.jar") { //release jar - file location not provided anywhere in loom
					classifier null
					builtBy remapJar
				},
				artifact ("${project.buildDir.absolutePath}/libs/${archivesBaseName}-${version}-dev.jar") { //release jar - file location not provided anywhere in loom
					classifier "dev"
					builtBy remapJar
				},
				artifact (sourcesJar)
			]
		}
	}
}

task sourcesJar(type: Jar) {
	baseName = archivesBaseName
	classifier = "sources"
	from sourceSets.main.allSource
	from sourceSets.main.resources
}